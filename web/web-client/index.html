<!DOCTYPE html>
<html>
<head>
	<title>Welcome!</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.25/webcam.min.js"> </script> 

</head>
<body>

<nav class="navbar navbar-dark bg-dark">
  <span class="navbar-brand mb-0 h1">Marketplace</span>
</nav>

<div style="width:100%;"> <!-- Main Div -->
    
    <div style="float:left; width:50%;">
        <div style="margin: 6em;">
            <div id="my_camera_div" style="display: block;">
                <div id="my_camera" style="width:640px; height:480px;"></div>
            </div>
            <div id="my_result_div" style="display: none">
                <div id="my_result"></div>
            </div>
        </div>


        <div id="newusercaptureresetbuttonset" style="display: none; align-items: center; margin-left: -9em; justify-content: space-evenly">
            <button type="button" class="btn btn-primary" onclick="take_snapshot()">Capture</button>
            <button type="button" class="btn btn-primary" onclick="retake()">Reset</button>
        </div>

        <div id="oldusersenddatabutton" style="display:block; align-items: center; width: 50%; margin-left: 13%;">
        	<!-- <button id=""verifyidentity" type="button" class="btn btn-info btn-block" onclick="take_snapshot()">Verify Identity</button> -->
            <button id="lalala" type="button" class="btn btn-info btn-block" onclick="take_snapshot()">Verify Identity</button>
        </div>



    </div>

    <div style="float:left; width:50%;">
        <div style="width: 70%; margin-top:8em ">
        	

        	<div style=" display: flex; align-items: center; margin-left: -1em; justify-content: space-evenly;">
        		<div class="form-check-inline">
        			<label class="form-check-label active">
        				<input type="radio" class="form-check-input" name="optradio" id="opt1" checked="">Old User
        			</label>
        		</div>
        		<div class="form-check-inline">
        			<label class="form-check-label">
        				<input type="radio" class="form-check-input" name="optradio" id="opt2">New User
        			</label>
        		</div>
        	</div>


        	<br/>
        	<br/>


        	<div id="newuserenterdetailsform" style="display: none">
	            <form>
	                <div class="form-group">
	                    <input class="form-control" type="text" placeholder="Name">
	                </div>
	                <div class="form-group">
	                    <input class="form-control" type="text" placeholder="Email">
	                </div>
	                <div class="form-group">
	                    <input class="form-control" type="text" placeholder="Paytm Number">
	                </div>
	                <div class="form-group">
	                    <input class="form-control" type="text" placeholder="OTP">
	                </div>
	              <button id="senddatabutton" type="submit" class="btn btn-primary">Submit</button>
	            </form>
	        </div>
        </div>
    </div>
    
</div>


<script language="JavaScript">
    function retake() {
        document.getElementById("my_camera_div").style.display = "block";
        document.getElementById("my_result_div").style.display = "none";
    }
</script>

<script type="text/javascript">
	
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="js/senddata.js"></script>

<script language="JavaScript">

    Webcam.attach( '#my_camera' );

    function take_snapshot() {
        Webcam.snap( function(data_uri) {
            document.getElementById("my_camera_div").style.display = "none";
            document.getElementById("my_result_div").style.display = "block";
            document.getElementById('my_result').innerHTML = '<img src="'+data_uri+'"/>';
			console.log("asdadas");
			//console.log(data_uri);
			console.log("Doneeee");
            msg = verifyIdentity(data_uri);
			//alert(msg)
        } );
    }
	
	function dataURItoBlob(dataURI) {
		var byteString = atob(dataURI.split(',')[1]);
		var ab = new ArrayBuffer(byteString.length);
		var ia = new Uint8Array(ab);
		for (var i = 0; i < byteString.length; i++) {
			ia[i] = byteString.charCodeAt(i);
		}
		return new Blob([ab], { type: 'image/jpeg' });
	}


    function verifyIdentity(data_uri) {
	     console.log("Entered verifyIdentity");
         var file =  data_uri;
		 
         var formdata = new FormData();
         formdata.append('	', file);
		 //console.log(file);
         $.ajax({
            url: '/olduserverify',
			enctype: 'multipart/form-data',
            data: file,
            type: "POST", //ADDED THIS LINE
            // THIS MUST BE DONE FOR FILE UPLOADING
            contentType: false,
            processData: false,
            // ... Other options like success and etc
            success: function(msg){
                //alert(msg);
				document.getElementById("my_camera_div").style.display = "block";
				document.getElementById("my_result_div").style.display = "none";
				alert(msg);
            },
            error: function(msg){
                alert("failure : "+msg);
				document.getElementById("my_camera_div").style.display = "block";
				document.getElementById("my_result_div").style.display = "none";
            }
        });
    }

</script>

</body>
</html>
